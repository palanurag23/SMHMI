# Introduction

This chapter focuses on usages of the resource generator tool, which is used to pack some resource files into a binary file. In TLHMI project, there are some huge resource files being used, such as some pictures used by LVGL, some prompts and music files used by audio player and some big VIT model files used in Smart Panel App. In order to reduce compiler linking time cost, it's a good practise to extract these resource files from project, and build them into a independent binrary file.

# How to use resource generator tool

We can generate the resource binrary file by running a script file which locates in second level directory of App root.
Provide two build versions for the resource generator tool. The one suffixed with `bat` is built for Windows. The other one suffixed with `sh` is used for Linux. This chapter is written based on Linux environment.
For Coffee Machine App, navigate to `./coffee_machine/resource/` and run `bash coffee_machine_resource_build.sh`

Look into the script file, it actually leverages the `../../tools/resource_build/resource_build` tool and provide required parameters.

 <fig>
    <image href="img/resource_generator_script.png" placement="break">
    </image> 
 </fig>

`resource_build` executable binrary supports three paratmers:
- description file: the name of description file
- binary file name (optional): By default, the name of generated binary file is "resources.bin"
- image file format (optional): By default, it is set to 0 (LV_COLOR_16_SWAP == 0). Image data layout is little endian. Otherwise image data layout is big endian.

In most cases, we do not need to do any changes to resource generator tool. Just run the script with default parameters, but we need to update the description file based on specified projects.

# Descriptions of resource file

In the description file, it contains the directory information of resource files. For most of case we need to update the directory information based on where the resource file we are using is. There are four types of resource in description file: image/icon/sound/model.
Please keep in mind, need to follow above resource type order during updating resource directory information.

 <fig>
    <image href="img/resource_file_index.png" placement="break">
    </image> 
 </fig>

## Resource file type

- image type

The image files are generated by `GUI-Guide` and automatically saved in the gui_guide/generated/images folder. The latest GUI-Guide can be found at this address: [GUI-Guide Tool](https://www.nxp.com/design/software/development-software/gui-guider:GUI-GUIDER)


```c
const uint8_t _Americano_250x250_map[] = {
#if LV_COLOR_DEPTH == 16 && LV_COLOR_16_SWAP == 0
  0xff, 0xff, 0x00, 0xff, 0xff, 0x00, 0xff, 0xff, 0x00, 0xff, 0xff, ...
#endif
#if LV_COLOR_DEPTH == 16 && LV_COLOR_16_SWAP != 0
  0xff, 0xff, 0x00, 0xff, 0xff, 0x00, 0xff, 0xff, 0x00, 0xff, 0xff, ...
#endif
};
```
- Icon file

Icon files are automatically generated by GUI-Guide Tool

```c
#ifndef _NXP_LOGO_H_
#define _NXP_LOGO_H_

#define NXP_LOGO_W 240
#define NXP_LOGO_H 86

static const unsigned short nxp_logo_240x86[] = {
  0xFDA4, 0xFD83, 0xFD83, 0xFD83, 0xFD83, 0xFD83, 0xFD83, 0xFD83, ...
};
#endif /* _NXP_LOGO_H_ */
```

- Audio file

The audio header files can be generated by some free tools, such as `xxd`, 'Audacity' or `WAVToCode`.

```c
/**********************************************************************
* Written by WAVToCode
* FileName:			Can_I_help.h
* Signed:			Yes
* No. of channels:	1
* No. of samples:	14211
* Bits/Sample:		16
**********************************************************************/

#define WW_DETECT_EN_LEN  sizeof(ww_detect_en)

short ww_detect_en[14211] = {
  0,   0,   0,   1,  -2,   2,  -1,   0, /* 0-7 */
  1,  -1,   1,  -2,   2,  -1,   0,   1, /* 8-15 */
  ...
  2,   0,  -1}; /* 14208-14210 */
```

***NOTE
In Coffee Machine and Elevator, audio files are in 16KHz/16bit/Mono Wav formate.
Audio files in Smart Panel are 48KHz/16Bit/Mono MP3 formate. Since audio resource file in Smart panel is very big, We have to compress auido resource into MP3 from Wav to save flash memory resource. And Smart Panel App integrated MP3 stream decoder.
***

- VIT Model file

VIT model is generated by VIT online tool:https://vit.nxp.com/#/generate
Reference [vit_instructions.md](voice/vit_instructions.md) get more details.

***NOTE
Need to update the model array type as `const unsigned char`. By default, the array are defined with aligned attribute.
`resource_build` has considered the model algined requirement very well. But `resource_build` does not understand the macros defined in vit.h, so we need to manually update the array type.
***

```c
/*
VIT_Model version : v4.8.0

WakeWord supported : 
    WW_Id  : WW_Name
      1    : HEY NXP

Voice Commands supported
    Cmd_Id : Cmd_Name
      0    : UNKNOWN
      1    : THERMOSTAT
      2    : SECURITY
      3    : AUDIO PLAYER
*/

const unsigned char VIT_Model_Main_Menu_en[] = {
0xa2, 0x34, 0xfe, 0xab, 0x00, 0x08, 0x04, 0x00, 0x02, 0x00, 0x03, 0x00, 0x01, 0x00, 0x01, 0x00, 0x02, 0x00, 0x00, 0x00, 0x68, 0x05, 0x00, 0x00, 0x04,
...
0x0c, 0x63, 0x0c, 0x65, 0x0c, 0x67, 0x0c, 0x69, 0x0c, 0x6b, 0x0c, 0x6d, 0x0c, 0x6f, 0x0c, 0x71, 0x0c, 0x75, 0x0c, 0x77, 0x0c, 0x79, 0x0c, 0x7b, 0x0c,
0x7d, 0x0c, 0x80, 0x0c, 0x84, 0x0c, 0x86, 0x0c, 0x88, 0x0c, 0x8a, 0x0c, 0x0a, 0x00, 0x2c, 0x01, 0x00, 0x00, 0x00, 0x41, 0x00, 0x00, 0xc0, 0x3f, 0x66,
0x66, 0xc6, 0x3f, 0xba, 0x89, 0xed, 0x56,  };

```
# Update the device firmware based on resource generator output

After resource generator running succesfully, it will generate a file named resource_information_table.txt, which contains binary resource layout information. We need to reference this file to update device firmware. Otherwise device firmware cannot correctly parse resource binary. 

Assume we are referencing smart panel App.The file of resource_information_table.txt consists of 4 parts:
- Image index list

 <fig>
    <image href="img/image_index.png" placement="break">
    </image> 
 </fig>

 - Icon index list
  
 <fig>
    <image href="img/icon_index.png" placement="break">
    </image> 
 </fig>

- Music/Prompt index list

 <fig>
    <image href="img/music_prompt_index.png" placement="break">
    </image> 
 </fig>

- VIT model index list

 <fig>
    <image href="img/vit_model_index.png" placement="break">
    </image> 
 </fig>

- Each type resource total size

 <fig>
    <image href="img/each_resource_size.png" placement="break">
    </image> 
 </fig>

## Update image index in custom.c

 <fig>
    <image href="img/update_image_index.png" placement="break">
    </image> 
 </fig>

## Update icon index in hal_output_ui_home_panel.c

 <fig>
    <image href="img/update_icon_index.png" placement="break">
    </image> 
 </fig>

 ## Update Music/Prompt index in smart_tlhmi_mqs.c

  <fig>
    <image href="img/update_music_prompt_index.png" placement="break">
    </image> 
 </fig>

 ## Update VIT model index in smart_tlhmi_vit.c

 <fig>
    <image href="img/update_vit_model_index.png" placement="break">
    </image> 
 </fig>

 ## Update all each type resource size in app_config.h

  <fig>
    <image href="img/update_each_resource_size.png" placement="break">
    </image> 
 </fig>
